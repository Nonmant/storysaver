document.body.setAttribute("onmousemove","FakeStories={showFeedStory: function(e, r) { if (!r.metaKey && !r.ctrlKey) { var o = { w: 'story' + e, query: JSON.stringify({ from_feed: 1 }) }; return storiesUserId = nav.fromStr(nav.strLoc).stories_user_id, storiesUserId && (o.stories_user_id = storiesUserId), showWiki(o), cancelEvent(r) } }, init:function(e){ window.divStories=document.createElement('div'); window.divStories.setAttribute('style','top:50%;left:50%;position: absolute;'); var flagStoriesAll=false; window.aStories=Array(e.stories_list.length); window.imgStories=Array(e.stories_list.length); if(e.stories_list.length>1){ flagStoriesAll=true; } for(var i=0; i<e.stories_list.length;i++) { window.aStories[i]=Array(e.stories_data[ e.stories_list[i] ].length); window.imgStories[i]=Array(e.stories_data[ e.stories_list[i] ].length); if(e.stories_data[ e.stories_list[i] ].length>1){ flagStoriesAll=true; } for(var j=0; j<e.stories_data[ e.stories_list[i] ].length; j++){ window.aStories[i][j]=document.createElement('a'); window.aStories[i][j].setAttribute('class','aStorySaver'); window.aStories[i][j].setAttribute('download',true); window.aStories[i][j].setAttribute('onclick','style=`filter: grayscale(100%);`'); var index=e.stories_data[ e.stories_list[i] ][j].src.indexOf('?'); if(index!=-1){ window.aStories[i][j].setAttribute('href',e.stories_data[ e.stories_list[i] ][j].src.substring(0,index)); } else{ window.aStories[i][j].setAttribute('href', e.stories_data[ e.stories_list[i] ][j].src); } window.imgStories[i][j]=document.createElement('img'); window.imgStories[i][j].setAttribute('src','https://i.imgur.com/jmTkpkL.png'); window.imgStories[i][j].setAttribute('style','padding : 2px'); window.aStories[i][j].appendChild(window.imgStories[i][j]); window.divStories.appendChild(window.aStories[i][j]); } window.divStories.appendChild(document.createElement('br')); } if(flagStoriesAll){ window.imgStoriesAll=document.createElement('img'); window.imgStoriesAll.setAttribute('src','https://i.imgur.com/nfbb1l0.png'); window.imgStoriesAll.setAttribute('title','Сохранить все'); window.imgStoriesAll.setAttribute('style','padding : 2px; cursor: pointer;'); window.funcStoriesAll=function(){ var numStoriesAll=document.getElementsByClassName('aStorySaver').length; for(var i=0; i<numStoriesAll; i++){ var clickEventStories = document.createEvent('MouseEvent'); clickEventStories.initMouseEvent('click', true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null); document.getElementsByClassName('aStorySaver')[i].dispatchEvent(clickEventStories); } }; window.imgStoriesAll.setAttribute('onclick', 'window.funcStoriesAll()'); window.divStories.appendChild(window.imgStoriesAll); } window.pStories=document.createElement('p'); window.pStories.innerText='После сохранения вкладку не перезагружать, а закрыть!'; window.pStories.setAttribute('style','color:white'); window.divStories.appendChild(window.pStories); document.getElementById('stories_view_cont').remove(); document.getElementById('wk_layer').remove(); document.getElementById('wk_layer_wrap').appendChild(window.divStories); }, onResize:function(){}, hideLayer:function(){} }; window.Stories=FakeStories; document.body.setAttribute('onmousemove',''); stManager._wait=function() { var l = __stm._waiters.length, checked = {}, handlers = []; if (!l) { clearInterval(__stm._waitTimer); __stm._waitTimer = false; return; } for (var j = 0; j < l; ++j) { var wait = __stm._waiters[j][0]; for (var i = 0, ln = wait.length; i < ln; ++i) { var f = wait[i]; if (!checked[f]) { if (!StaticFiles[f].l && StaticFiles[f].t == 'css' && getStyle(StaticFiles[f].n, 'display') == 'none') { __stm.done(f); } if (StaticFiles[f].l) { checked[f] = 1; } else { checked[f] = -1; if (vk.loaded) { var c = ++StaticFiles[f].c; if (c > __stm.lowlimit && stVersions[f] > 0 || c > __stm.highlimit) { if (stVersions[f] < 0) { topError('<b>Error:</b> Could not load <b>' + f + '</b>.', {dt: 5, type: 1, msg: 'Failed to load with ' + __stm.lowlimit + '/' + __stm.highlimit + ' limits (' + ((vkNow() - vk.started) / 100) + ' ticks passed)', file: f}); StaticFiles[f].l = 1; checked[f] = 1; } else { topMsg('Some problems with loading <b>' + f + '</b>...', 5); stVersions[f] = irand(-10000, -1); __stm._add(f, StaticFiles[f]); } } } } } if (checked[f] > 0) { wait.splice(i, 1); --i; --ln; } if(Stories!=FakeStories){ Stories=FakeStories; } } if (!wait.length) { handlers.push(__stm._waiters.splice(j, 1)[0][1]); --j; --l; } } for (var j = 0, l = handlers.length; j < l; ++j) { handlers[j](); } };");
